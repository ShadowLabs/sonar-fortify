<h2>ABSTRACT</h2>
<p>
   Constructing a SimpleDB select statement that contains user input can allow an attacker to view unauthorized records.
</p>
<h2>EXPLANATION</h2>
<p>
  Query string injection vulnerabilities occur when:<br />1. Data enters a program from an untrusted source.<br /><br /><p><br />In this case the data enters at <Replace key="SourceFunction" link="SourceLocation"/> in <Replace key="SourceLocation.file"/> at line <Replace key="SourceLocation.line"/>. <br /></p><br /><br />2. The data is used to dynamically construct a SimpleDB query string.<br /><br /><p><br />In this case the data is passed to <Replace key="SinkFunction" link="SinkLocation"/> in <Replace key="SinkLocation.file"/> at line <Replace key="SinkLocation.line"/>.<br /></p><br /><p><br />Unlike SQL injection, query string injection attacks do not allow attackers to alter the state of the database in any way. However they do allow malicious users to view unauthorized records, as do SQL injection attacks.<br /></p><br /><b>Example 1:</b> The following code dynamically constructs and executes a SimpleDB <code>select()</code> query that searches for invoices that match a user-specified product category. The user can also specify the column by which the results are sorted. Assume that the application has already properly authenticated and set the value of <code>customerID</code> prior to this code segment.<br />  <br /><pre><br />...<br />String customerID = getAuthenticatedCustomerID(customerName, customerCredentials);<br />...<br />AmazonSimpleDBClient sdbc = new AmazonSimpleDBClient(appAWSCredentials);<br />String query = "select * from invoices where productCategory = '" <br />            + productCategory + "' and customerID = '"  <br />            + customerID + "' order by '"<br />            + sortColumn + "' asc";<br />SelectResult sdbResult = sdbc.select(new SelectRequest(query));<br />...<br /></pre><br /><br />The query that this code intends to execute looks like:<br /><br /><pre><br />select * from invoices<br />where productCategory = 'Fax Machines'<br />and customerID = '12345678'<br />order by 'price' asc<br /></pre><br /><br />However, because the query is constructed dynamically by concatenating a constant base query string and a user input string, the query only behaves correctly if <code>productCategory</code> and <code>price</code> do not contain single-quote characters. If, however, an attacker provides the string "<code>Fax Machines' or productCategory = \"</code>" for <code>productCategory</code>, and the string "<code>\" order by 'price</code>" for <code>sortColumn</code>, then the query becomes the following:<br /><br /><pre><br />select * from invoices<br />where productCategory = 'Fax Machines' or productCategory = "'<br />and customerID = '12345678'<br />order by '" order by 'price' asc<br /></pre><br /><br />or, in a more human-readable form,<br /><br /><pre><br />select * from invoices<br />where productCategory = 'Fax Machines'<br />or productCategory = "' and customerID = '12345678' order by '"<br />order by 'price' asc<br /></pre><br /><br />These inputs allow an attacker to bypass the required authentication for <code>customerID</code>, and allows the attacker to view invoice records matching <code>'Fax Machines'</code> for all customers.
</p>
<h2>REFERENCES</h2>
<p>
  
</p>