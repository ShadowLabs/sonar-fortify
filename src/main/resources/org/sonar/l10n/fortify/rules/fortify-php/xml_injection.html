<h2>ABSTRACT</h2>
<p>
  Writing unvalidated data into an XML document can allow an attacker to change the structure and contents of the XML.
</p>
<h2>EXPLANATION</h2>
<p>
  XML injection occurs when:<br /><br />1. Data enters a program from an untrusted source.<br /><p><br />In this case the data enters at <Replace key="SourceFunction" link="SourceLocation"/> in <Replace key="SourceLocation.file"/> at line <Replace key="SourceLocation.line"/>.<br /></p><br /><IfDef var="ConditionalDescriptions"><br /> <p><br />  <ConditionalText condition="taint:number"><br />Even though the data in this case is a number, it is unvalidated and thus still considered malicious, hence the vulnerability is still reported but with reduced priority values.<br />  </ConditionalText><br /> </p><br /></IfDef><br /><br />2. The data is written to an XML document. <br /><p><br />In this case the XML is written by <Replace key="SinkFunction" link="SinkLocation"/> in <Replace key="SinkLocation.file"/> at line <Replace key="SinkLocation.line"/>.<br /></p><br />Applications typically use XML to store data or send messages. When used to store data, XML documents are often treated like databases and can potentially contain sensitive information. XML messages are often used in web services and can also be used to transmit sensitive information. XML message can even be used to send authentication credentials.<br /><br />The semantics of XML documents and messages can be altered if an attacker has the ability to write raw XML. In the most benign case, an attacker might be able to insert extraneous tags and cause an XML parser to throw an exception. In more nefarious cases of XML injection, an attacker might be able to add XML elements that change authentication credentials or modify prices in an XML e-commerce database. In some cases, XML injection can lead to Cross-Site Scripting or Dynamic Code Evaluation.<br /><br /><b>Example 1:</b> <br /><br />Assume an attacker is able to control <code>shoes</code> in following XML.<br /><pre><br />&lt;order&gt;<br />   &lt;price&gt;100.00&lt;/price&gt;<br />   &lt;item&gt;shoes&lt;/item&gt;<br />&lt;/order&gt;<br /></pre><br /><br />Now imagine this XML is included in a back end web service request to place an order for a pair of shoes. Suppose the attacker modifies his request and replaces <code>shoes</code> with <code>shoes&lt;/item&gt;&lt;price&gt;1.00&lt;/price&gt;&lt;item&gt;shoes</code>. The new XML would look like:<pre><br />&lt;order&gt;   &lt;price&gt;100.00&lt;/price&gt;   &lt;item&gt;shoes&lt;/item&gt;&lt;price&gt;1.00&lt;/price&gt;&lt;item&gt;shoes&lt;/item&gt;&lt;/order&gt;<br /></pre><br /><br />When using XML parsers, the value from the second <code>&lt;price&gt;</code> overrides the value from the first <code>&lt;price&gt;</code> tag. This allows the attacker to purchase a pair of $100 shoes for $1.<br /><br /><br />A more serious form of this attack called XML eXternal Entity Injection can occur when the attacker controls the front or all of the XML document which is parsed.<br /><br /><b>Example 2:</b> Here is some code that is vulnerable to XXE attacks:<br /><br />Assume an attacker is able to control the input XML to the following code:<br /><br /><pre><br />...<br />&lt;?php<br />$goodXML = $_GET[&quot;key&quot;];<br />$doc = simplexml_load_string($goodXml);<br />echo $doc-&gt;testing;<br />?&gt;<br />...<br /></pre><br /><br />Now imagine that the following XML is passed by the attacker to the code above:<br /><br /><pre><br /><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br /> &lt;!DOCTYPE foo [<br />   &lt;!ELEMENT foo ANY &gt;<br />   &lt;!ENTITY xxe SYSTEM &quot;file:///c:/boot.ini&quot; &gt;]&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;<br /><br /></pre><br /><br />When the xml is processed, the content of the &lt;foo&gt; element is populated with the contents of the system's boot.ini file.  The attacker can utilize xml elements which are returned to the client to exfiltrate data or obtain information as to the existence of network resources.
</p>
<h2>REFERENCES</h2>
<p>
  
</p>