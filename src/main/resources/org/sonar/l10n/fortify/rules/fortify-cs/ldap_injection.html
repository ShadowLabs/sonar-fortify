<h2>ABSTRACT</h2>
<p>
  Constructing a dynamic LDAP filter with user input could allow an attacker to modify the statement's meaning.
</p>
<h2>EXPLANATION</h2>
<p>
  LDAP injection errors occur when:<br /><br />1.	Data enters a program from an untrusted source.<br /><p><br />In this case the data enters at <Replace key="SourceFunction" link="SourceLocation"/> in <Replace key="SourceLocation.file"/> at line <Replace key="SourceLocation.line"/>. <br /></p><br />2.	The data is used to dynamically construct a LDAP filter. <br /><p><br />In this case the data is passed to <Replace key="SinkFunction" link="SinkLocation"/> in <Replace key="SinkLocation.file"/> at line <Replace key="SinkLocation.line"/>.<br /></p><br /><b>Example 1:</b> The following code dynamically constructs and executes an LDAP query that retrieves records for all the employees who report to a given manager. The manager's name is read from an HTTP request, and is therefore untrusted.  <br /><br /><pre><br />...<br />DirectorySearcher src = <br />           new DirectorySearcher("(manager=" + managerName.Text + ")");<br />src.SearchRoot = de;<br />src.SearchScope = SearchScope.Subtree;<br /><br />foreach(SearchResult res in src.FindAll()) {<br />  ...<br />}<br /></pre><br /><br />Under normal conditions, such as searching for employees who report to the manager John Smith, the filter that this code executes will look like the following:<br /><br /><pre><br />(manager=Smith, John)<br /></pre><br /><br />However, because the filter is constructed dynamically by concatenating a constant base query string and a user input string, the query only behaves correctly if <code>managerName</code> does not contain any LDAP meta characters. If an attacker enters the string <code>Hacker, Wiley)(|(objectclass=*)</code> for <code>managerName</code>, then the query becomes the following:<br /><br /><pre><br />(manager=Hacker, Wiley)(|(objectclass=*))<br /></pre><br /><br />Based on the permissions with which the query is executed, the addition of the <code>|(objectclass=*)</code> condition causes the filter to match against all entries in the directory, and allows the attacker to retrieve information about the entire pool of users. Depending on the permissions with which the LDAP query is performed, the breadth of this attack may be limited, but if the attacker can control the command structure of the query, such an attack can at least affect all records that the user the LDAP query is executed as can access.
</p>
<h2>REFERENCES</h2>
<p>
  
</p>